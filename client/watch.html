<template name="context_browser_area">
  <div class="row">
  {{#if curateMode}}
    {{#if showContextDeck}}
    <div class="col-xs-2">
      {{> context_card_column}}
    </div>
    {{/if}}
  {{/if}}
    <div class="col-xs-{{#if curateMode}}{{#if showContextDeck}}10{{else}}12{{/if}}{{else}}12{{/if}}">
      {{> context_browser show=showSuggestions suggestions=true contextBlocks=pendingSuggestions deepstream=deepstreamForContext}}
      {{> timeline_section show=showTimeline}}
      {{> context_browser show=showContextDeck contextBlocks=orderedContext curatorName=curatorName}}
    </div>
  </div>
</template>

<template name="settings_modal">
  <div class="modal fade" id="settings-modal" tabindex="-1" role="dialog" aria-labelledby="settingsModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <p class="lead">Your Deepstream's Settings</p>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6">
              <div class="row">
                <div class="col-xs-12">
                  {{> title_description_inlay}}
                </div>
              </div>
            </div>
            <div class="col-md-6">
               <div class="checkbox">
                <label>
                  <input class="publish-toggle" type="checkbox" data-on="Public" data-off="Private" data-toggle="toggle" data-onstyle="success" data-offstyle="primary" data-width="100">
                </label>
              </div>
              <div class="checkbox">
                <label>
                  <input class="replay-toggle" type="checkbox" data-toggle="toggle" data-onstyle="success" disabled="{{#unless replayAvailable}}disabled{{/unless}}">
                  Replay Context
                </label>
              </div>
              
              <div class="checkbox">
                <label>
                  <input class="director-mode-toggle" type="checkbox" data-toggle="toggle" data-onstyle="success">
                  Director Mode
                </label>
              </div>
              <button class="btn btn-default embed-code-button">Get Embed Code</button>
            </div>
          </div>
          {{#if isMainCurator}}
          <div class="row">
            <div class="col-xs-12">
              <p><strong>Curator options:</strong></p>
               <form id="invite-curator" action="">
                 <label for="invite-curator-input">Invite a new curator by email</label>
                 <div class="input-group">
                    <input id="invite-curator-input" type="email" class="form-control" placeholder="Email address" name="new-curator-email" disabled="{{disableInviteForm}}">
                    <span class="input-group-btn">
                      <button class="btn btn-outline-success invite-curator" type="submit" disabled="{{disableInviteForm}}"><i class="fa fa-plus"></i></button>
                    </span>
                  </div>
                </form>
              <table class="table table-hover"> 
                <thead> 
                  <tr> 
                    <th>Profile Name</th>
                    <th>Remove</th>
                  </tr> 
                </thead> 
                <tbody> 
                  <tr> 
                    <td>{{currentUser.profile.name}}</td>
                    <td>This is you!</td> 
                  </tr> 
                  {{#each additionalCurators}}
                  <tr> 
                    <td>{{profile.name}}</td>
                    <td class="text-danger remove-curator"><i class="fa fa-close js-link"></i></td> 
                  </tr> 
                  {{/each}}
                </tbody> 
              </table>
            </div>
          </div>
          {{/if}}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
</template>

<template name="more_info_modal"> 
  {{#with thisDeepstream}}
  <div class="modal fade" id="more-info-modal" tabindex="-1" role="dialog" aria-labelledby="moreInfoModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <div class="row">
            <div class="col-xs-6">
              <p class="lead">More Info</p>
            </div>
            <div class="col-xs-6">
               <div class="stream-stats-and-share pull-right">
                  <div class="share-and-favorite">
                    {{> favorite_button}}
                    <button class="twitter-share-button">{{> twitter_share_icon}}</button>
                    <button class="facebook-share-button">{{> facebook_share_icon}}</button>
                    <button class="email-share-button">{{> email_share_icon}}</button>
                    <button class="embed-code-button" data-clipboard-text='true'>{{> embed_code_icon}}</button>
                  </div>
                </div>
            </div>
          </div>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-xs-12">
              <p><strong>Title</strong></p>
              <p>{{title}}</p>
              <p><strong>Description</strong></p>
              <p>{{description}}</p>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="row">
                <div class="col-xs-12">
                  <p><strong>Stats</strong></p>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-4 text-center">
                  <p><i class="fa fa-eye fa-2x"></i></p>
                  <p>{{formatNumber viewCount}} views</p>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <p><strong>Creator</strong></p>
              <p>{{curatorNames}}</p>
              <p>Published on {{formatDateNice firstOnAirAt}}</p>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  {{/with}}
</template>

<template name="watch_page">
  {{> modals}}
  <div class="new-watch">

    {{#if featuredMode}}
      <style>
        .right-section:not(.featured-context-container){
          display: none;
        }
      </style>
    {{/if}}
    <header>
    {{> minimal_navbar fixed=showRightSection showDesktopMode=showDesktopMode}}
    </header>
    {{#with thisDeepstream}}
      {{#if loadingScreen}} {{else}}
      
  {{#if showDesktopMode}}
    <div class="watch {{#if thisDeepstream.onAir}}on-air{{else}}off-air{{/if}} {{#if curateMode}}curate-mode{{/if}}" style="width: {{windowWidth}}px; height: {{mainStreamHeight}}px;">
    {{#if showTutorial}}
      <!-- development mode remove steps
       <div class="create-overlay" style="height: {{windowHeight -80}}px;"></div>
      -->
    {{/if}}
    <div class="row" style="margin-right: 0px;">
      <div class="{{#if cardListContainerHidden}}col-xs-12{{else}}col-xs-8{{/if}} animate" id="watch-video-container">
            {{#if showTutorial}}
            {{> creation_tutorial}}
            {{/if}}
            {{#if streamUrl}}
            <div class="main-stream-container"  style="height: {{mainStreamHeight}}px;">
            <iframe id="{{mainStreamIFrameId}}"
                    class="embed-responsive-item {{#unless mainStreamInIFrame}}hide{{/unless}} {{#if facebookIframe}}facebook{{/if}}"
                    src="{{#if mainStreamInIFrame}}{{streamUrl}}{{/if}}" frameborder="0"
                    style="height: {{mainStreamHeight}}px; width:100%;"
                    allowfullscreen></iframe>
            {{#if mainStreamInFlashPlayer}}
              {{#unless removeMainStream}}
              {{#if bambuserPlayer}}
                <object id="{{mainStreamFlashPlayerId}}" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"
                        class="embed-responsive-item main-stream-flash-object " style="height: {{mainStreamHeight}}px; width:100%;">
                  <embed name="{{mainStreamFlashPlayerId}}" src="//static.bambuser.com/r/player.swf"
                         type="application/x-shockwave-flash" flashvars="{{mainStreamFlashVars}}" allowfullscreen="true"
                         allowscriptaccess="always" wmode="opaque"/>
                  <param name="movie" value="//static.bambuser.com/r/player.swf"/>
                  <param name="flashvars" value="{{#if mainStreamInFlashPlayer}}{{mainStreamFlashVars}}{{/if}}"/>
                  <param name="allowfullscreen" value="true"/>
                  <param name="allowscriptaccess" value="always"/>
                  <param name="wmode" value="opaque"/>
                </object>
              {{else}}
                {{#if twitchPlayer}}
                  <object id="{{mainStreamFlashPlayerId}}"
                          bgcolor='#000000'
                          data='//www-cdn.jtvnw.net/swflibs/TwitchPlayer.swf'
                          class="embed-responsive-item main-stream-flash-object "
                          type='application/x-shockwave-flash'
                          style="height: {{mainStreamHeight}}px; width:100%;">

                    <param name="allowFullScreen"
                           value="true"/>
                    <param name="allowNetworking"
                           value="all"/>
                    <param name="allowScriptAccess"
                           value="always"/>
                    <param name='movie'
                           value='//www-cdn.jtvnw.net/swflibs/TwitchPlayer.swf'/>
                    <param name='flashvars'
                           value='{{mainStreamFlashVars}}'/>
                  </object>
                {{/if}}
                {{#if twitcastPlayer}}
                  {{#if PiP}}
                  <div id="twitcastOverlay" style="width:285px; height:160px;"></div>
                  <object id="{{mainStreamFlashPlayerId}}" 
                          classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"  codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0" 
                          width="285" 
                          height="160"
                          align="middle"
                          style="margin-left:-20px;">
                    <param name="allowScriptAccess" value="always" />
                    <param name="allowFullScreen" value="true" />
                    <param name="flashVars" value="{{mainStreamFlashVars}}" />
                    <param name="movie" value="http://twitcasting.tv/swf/livestreamer2sp.swf" />
                    <param name="quality" value="high" />
                    <param name="bgcolor" value="#ffffff" />
                    <embed src="http://twitcasting.tv/swf/livestreamer2sp.swf" 
                           quality="high" 
                           bgcolor="#ffffff" 
                           width="285" 
                           height="160" 
                           name="livestreamer" 
                           id="livestreamderembed" 
                           align="middle" 
                           allowScriptAccess="always" 
                           allowFullScreen="true" 
                           type="application/x-shockwave-flash" 
                           pluginspage="http://www.adobe.com/go/getflashplayer" 
                           flashVars="{{mainStreamFlashVars}}" >
                  </object>
                  {{else}}
                  <div id="twitcastOverlay" style="width:{{windowWidth}}px; height:{{windowHeight -100}}px;"></div>
                  <object id="{{mainStreamFlashPlayerId}}" 
                          classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"  codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0" 
                          width="{{windowWidth}}" 
                          height="{{windowHeight -50}}"
                          align="middle"
                          style="margin-left:-20px;"
                          class="embed-responsive-item">
                    <param name="allowScriptAccess" value="always" />
                    <param name="allowFullScreen" value="true" />
                    <param name="flashVars" value="{{mainStreamFlashVars}}" />
                    <param name="movie" value="http://twitcasting.tv/swf/livestreamer2sp.swf" />
                    <param name="quality" value="high" />
                    <param name="bgcolor" value="#ffffff" />
                    <embed src="http://twitcasting.tv/swf/livestreamer2sp.swf" 
                           quality="high" 
                           bgcolor="#ffffff" 
                           width="{{windowWidth}}" 
                           height="{{windowHeight -50}}" 
                           name="livestreamer" 
                           id="livestreamderembed" 
                           align="middle" 
                           allowScriptAccess="always" 
                           allowFullScreen="true" 
                           type="application/x-shockwave-flash" 
                           pluginspage="http://www.adobe.com/go/getflashplayer" 
                           flashVars="{{mainStreamFlashVars}}" >
                  </object>
                  {{/if}}
                {{/if}}
              {{/if}}
              {{/unless}}
            {{/if}}
          </div>
            {{/if}}
        </div>
      <div class="{{#if cardListContainerHidden}}col-xs-0{{else}}col-xs-4{{/if}} right animate" style="z-index: 10;" id="card-list-container">
          {{#unless showCurateTools}}
          <!-- begin Context switcher -->
          <span class="context-mode-switch js-link" style="position:absolute; bottom:25px; right: 40px;z-index:1;border: 1px solid; border-radius: 30px;background-color: rgba(255,255,255,0.9);">
            {{#if showShowTimelineButton}}
              {{#if showTimeline}}
              <i class="fa fa-bars" style="padding:12px;"></i>
              {{else}}
              <i class="fa fa-twitter fa-2x" style="padding:5px;"></i>
              {{/if}}
            {{/if}}
          </span>
          <!-- end Context switcher -->
          {{/unless}}
          <!-- begin Card List Area -->
          {{#with deepstreamForContext}}
            {{#if showDeck}}
            <div class="row card-list-area" style="height: {{mainStreamHeight}}px; overflow-y: scroll;-webkit-overflow-scrolling: touch;">
              <div class="col-xs-12">
              {{> context_browser_area deepstreamForContext}}
              </div>
            </div>
            {{/if}}
            {{#if showTimeline}}
            <div class="row card-list-area" style="height: {{mainStreamHeight}}px; overflow-y: scroll;-webkit-overflow-scrolling: touch; margin-bottom:0px;">
              <div class="col-xs-12">
              {{> context_browser_area deepstreamForContext}}
              </div>
            </div>
            {{/if}}
            {{#if showCurateTools}}
              <div class="row thumbnail card-list-area" style="height: {{mainStreamHeight}}px; overflow-y: scroll;-webkit-overflow-scrolling: touch; margin-bottom:0px;">
              <!-- add collapse here -->
              
              <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                {{#if isCurator}}
                <div class="panel panel-default">
                  <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    <div class="panel-heading" role="tab" id="headingOne">
                      <p>
                          <b>General:</b> Edit this stream experience's title, description and public/private setting.
                      </p>
                    </div>
                  </a>
                  <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
                    <div class="panel-body">
                      <div class="row">
                        <div class="col-xs-12">
                          {{> title_description_inlay}}
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xs-12">
                           <div class="checkbox">
                            <label>
                              <input class="publish-toggle" type="checkbox" data-on="Public" data-off="Private" data-toggle="toggle" data-onstyle="success" data-offstyle="primary" data-width="100">
                            </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                </div>
                <div class="panel panel-default">
                  <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                  <div class="panel-heading" role="tab" id="headingTwo">
                    <p>
                      <b>Stream list:</b> Add or remove videos/streams.
                    </p>
                  </div>
                    </a>
                  <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                    <div class="panel-body">
                      <div class="search-section-title" style="margin-top: -15px;margin-bottom:30px;">Current Streams</div>
                      <div class="streams-list" style="max-height:{{mainStreamHeight 0}}px; padding-top: 15px; margin-top: -30px;">
                        <div class="streams-list-container">
                        {{#each livestreams}}
                          {{> stream_li stream=this active=active allowPreview=false}}
                          {{this.title}}
                          <br/>
                        {{/each}}
                        {{#each deadstreams}}
                          {{> stream_li stream=this active=active allowPreview=false}}
                          {{this.title}}
                          <br/>
                        {{/each}}
                        </div>
                      </div>
                      <div class=" stream-search narrative-section selected editing" style="position:relative;">
                        {{> create_stream_section}}
                      </div>
                    </div>
                  </div>
                </div>
                {{/if}}
                <div class="panel panel-default">
                  <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                  <div class="panel-heading" role="tab" id="headingThree">
                    <p> 
                    {{#if isCurator}}
                      <b>Add Cards:</b> Create cards to be used in your DeepStream experience.
                    {{else}}
                      <b>Suggest Cards:</b> Suggest cards to be used in the broadcaster's DeepStream experience.
                    {{/if}}
                    </p>
                  </div>
                  </a>
                  <div id="collapseThree" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingThree">
                    <div class="panel-body">
                     <!-- start select context type -->
                      {{#if showSelectCardType}}
                        <div class="col-xs-12">
                        {{> content_icons}}
                        </div>
                      {{/if}}
                      <!-- end select context type -->
                      {{#if showContextSearch}}
                      <!-- start add context field -->
                      <div class="row card-list-area" style="height: {{mainStreamHeight}}px; overflow-y: scroll;-webkit-overflow-scrolling: touch;">
                        <div class="col-xs-12">
                        {{> add_context}}
                        </div>
                      </div>
                      <!-- end add context field -->
                      {{/if}}
                      
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {{/if}}
          {{/with}}
          <!-- End Card List Area -->
        </div>
      </div>
    </div>
            {{#with thisDeepstream}}
              <!--Fixed sections-->
              <!--
              {{#if showTitleDescriptionEditOverlay}}
                {{> title_description_overlay}}
              {{/if}}
              -->
              {{#if soloOverlayContextMode}}
                {{> overlay_context_browser}}
              {{/if}}
              {{> signin_overlay}}
              {{#if curatorWebcamActive}}
                {{#with getCuratorWebcamStream}}

                  <div class="curator-webcam-stream-container">
                    {{> curator_webcam_display}}

                    <!--<iframe-->
                        <!--class="curator-webcam-stream-iframe"-->
                        <!--src="{{autoplayUrl}}" frameborder="0"-->
                        <!--allowfullscreen></iframe>-->
                    {{#if curateMode}}
                      <button class="end-curator-webcam-stream">{{> close_circle}}</button>
                    {{/if}}
                  </div>
                {{/with}}
              {{/if}}
            {{/with}}
        {{else}}
          {{#if twitterTimelineMobile}}
    
          {{else}}
            <!-- 16:9 portrait aspect ratio -->
            <div class="embed-responsive embed-responsive-16by9 not-expanded main-stream-mobile">
              {{#if streamUrl}}
              <iframe id="{{mainStreamIFrameId}}"
                      class="embed-responsive-item {{#unless mainStreamInIFrame}}hide{{/unless}} {{#if facebookIframe}}facebook{{/if}}"
                      src="{{#if mainStreamInIFrame}}{{streamUrl}}{{/if}}" frameborder="0"
                      allowfullscreen></iframe>
              {{#if mainStreamInFlashPlayer}}
                {{#unless removeMainStream}}
                {{#if bambuserPlayer}}
                  <object id="{{mainStreamFlashPlayerId}}" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"
                          class="embed-responsive-item main-stream-flash-object ">
                    <embed name="{{mainStreamFlashPlayerId}}" src="//static.bambuser.com/r/player.swf"
                           type="application/x-shockwave-flash" flashvars="{{mainStreamFlashVars}}" allowfullscreen="true"
                           allowscriptaccess="always" wmode="opaque"/>
                    <param name="movie" value="//static.bambuser.com/r/player.swf"/>
                    <param name="flashvars" value="{{#if mainStreamInFlashPlayer}}{{mainStreamFlashVars}}{{/if}}"/>
                    <param name="allowfullscreen" value="true"/>
                    <param name="allowscriptaccess" value="always"/>
                    <param name="wmode" value="opaque"/>
                  </object>
                {{else}}
                  {{#if twitchPlayer}}
                    <object id="{{mainStreamFlashPlayerId}}"
                            bgcolor='#000000'
                            data='//www-cdn.jtvnw.net/swflibs/TwitchPlayer.swf'
                            class="embed-responsive-item main-stream-flash-object "
                            type='application/x-shockwave-flash'>

                      <param name="allowFullScreen"
                             value="true"/>
                      <param name="allowNetworking"
                             value="all"/>
                      <param name="allowScriptAccess"
                             value="always"/>
                      <param name='movie'
                             value='//www-cdn.jtvnw.net/swflibs/TwitchPlayer.swf'/>
                      <param name='flashvars'
                             value='{{mainStreamFlashVars}}'/>
                    </object>
                  {{/if}}
                  {{#if twitcastPlayer}}
                    {{#if PiP}}
                    <div id="twitcastOverlay" style="width:285px; height:160px;"></div>
                    <object id="{{mainStreamFlashPlayerId}}" 
                            classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" 
                            class="embed-responsive-item" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0" 
                            width="285" 
                            height="160"
                            align="middle"
                            style="margin-left:-20px; ">
                      <param name="allowScriptAccess" value="always" />
                      <param name="allowFullScreen" value="true" />
                      <param name="flashVars" value="{{mainStreamFlashVars}}" />
                      <param name="movie" value="http://twitcasting.tv/swf/livestreamer2sp.swf" />
                      <param name="quality" value="high" />
                      <param name="bgcolor" value="#ffffff" />
                      <embed src="http://twitcasting.tv/swf/livestreamer2sp.swf" 
                             quality="high" 
                             bgcolor="#ffffff" 
                             width="285" 
                             height="160" 
                             name="livestreamer" 
                             id="livestreamderembed" 
                             align="middle" 
                             allowScriptAccess="always" 
                             allowFullScreen="true" 
                             type="application/x-shockwave-flash" 
                             pluginspage="http://www.adobe.com/go/getflashplayer" 
                             flashVars="{{mainStreamFlashVars}}" >
                    </object>
                    {{else}}
                    <div id="twitcastOverlay" style="width:{{windowWidth}}px; height:{{windowHeight -100}}px;"></div>
                    <object id="{{mainStreamFlashPlayerId}}" 
                            classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" 
                            class="embed-responsive-item" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0" 
                            width="{{windowWidth}}" 
                            height="{{windowHeight -50}}"
                            align="middle"
                            style="margin-left:-20px; ">
                      <param name="allowScriptAccess" value="always" />
                      <param name="allowFullScreen" value="true" />
                      <param name="flashVars" value="{{mainStreamFlashVars}}" />
                      <param name="movie" value="http://twitcasting.tv/swf/livestreamer2sp.swf" />
                      <param name="quality" value="high" />
                      <param name="bgcolor" value="#ffffff" />
                      <embed src="http://twitcasting.tv/swf/livestreamer2sp.swf" 
                             quality="high" 
                             bgcolor="#ffffff" 
                             width="{{windowWidth}}" 
                             height="{{windowHeight -50}}" 
                             name="livestreamer" 
                             id="livestreamderembed" 
                             align="middle" 
                             allowScriptAccess="always" 
                             allowFullScreen="true" 
                             type="application/x-shockwave-flash" 
                             pluginspage="http://www.adobe.com/go/getflashplayer" 
                             flashVars="{{mainStreamFlashVars}}" >
                    </object>
                    {{/if}}
                  {{/if}}
                {{/if}}
                {{/unless}}

              {{/if}}
              {{/if}}
            </div>
            {{#if showPortraitShowTimelineButton}}
            <div style=" position: absolute; bottom:4%; right: 8%; cursor: pointer; z-index: 9999;min-height:35px; min-width:35px;" class="portrait-mode-switch">
              <i class="fa fa-{{#if showTimeline}}clone{{else}}twitter{{/if}} fa-2x fa-border" style="  border-color: #525252; background-color: #fff;"></i>
            </div>
            {{/if}}
            <div class="portrait-context-container">
              {{#if showPortraitShowTimelineButton}}
                {{#if showTimeline}}
                 {{> portrait_timeline_section show=showTimeline}}
                {{else}}
                  {{#with deepstreamForContext}}
                    {{> context_browser_portrait contextBlocks=orderedContext deepstream=deepstreamForContext}}
                  {{/with}}
                {{/if}}
              {{else}}
                {{#with deepstreamForContext}}
                  {{> context_browser_portrait contextBlocks=orderedContext deepstream=deepstreamForContext}}
                {{/with}}
              {{/if}}
          </div>
          {{/if}}
        {{/if}}
       {{/if}}
    {{/with}}
  </div>
</template>

<template name="context_browser_portrait">
  <div id="carousel-portrait-context" class="carousel slide" data-interval="false" data-ride="carousel" data-slide-to="1" style="height:{{carouselHeight}}px">
  <!-- Indicators 
  <ol class="carousel-indicators">
    <li data-target="#carousel-portrait-context" data-slide-to="0" class="active"></li>
    <li data-target="#carousel-portrait-context" data-slide-to="1"></li>
    <li data-target="#carousel-portrait-context" data-slide-to="2"></li>
  </ol>
  -->

  <!-- Wrapper for slides -->
  <div class="carousel-inner" role="listbox">
    <div class="item active title-card-portrait" style="height: {{carouselHeight}}px">
      <div class="embedly-card title-card">
        <div class="embedly-card-hug" style="width: 600px; padding: 0px; position: relative; max-width: 100%; margin: 5px auto;">
          <div class="card article">
            <div class="hdr">
              <div class="pull-right provider provider-gt-35">
                <a class="js-link toggle-card-expansion">
                  <i class="fa fa-arrows-v fa-inverse" style="padding: 0 8px;"></i>
                </a>
              </div>
            </div>
            <div class="bd" style="border-left-color: rgb(224, 42, 25);">
              <div class="pair-bd">
                  <div class="txt-bd">
                    <h1 class="title">
                      {{deepstream.title}}
                    </h1>
                    <div class="stream-stats-and-share">
                      <div class="share-and-favorite">
                        {{> favorite_button}}
                        <button class="twitter-share-button">{{> twitter_share_icon}}</button>
                        <button class="facebook-share-button">{{> facebook_share_icon}}</button>
                        <button class="email-share-button">{{> email_share_icon}}</button>
                        <button class="embed-code-button" data-clipboard-text='true'>{{> embed_code_icon}}</button>
                      </div>
                    </div>
                    <p class="description">{{deepstream.description}}</p>
                    <p class="description">{{formatNumber deepstream.viewCount}} views. Curated by: {{curatorNames}}</p>
                    <br/>
                    {{#if replayEnabled}}
                      {{#if replayAvailable}}
                      <div class="col-xs-12" style="text-align: center;">
                        <button class="btn curator-card-replay {{#if replayContextOn}}btn-success{{else}}btn-primary{{/if}}"><i class="fa fa-play-circle-o"></i> Replay Context {{#if replayContextOn}}On{{else}}Off{{/if}}</button>
                      </div>
                      {{/if}}
                    {{/if}}
                  </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {{#each contextBlocks}}
      {{> portrait_item_context_section}}
    {{/each}}
  </div>

  <!-- Controls -->
  <a class="left carousel-control" href="#carousel-portrait-context" role="button" data-slide="prev">
    <i class="fa fa-chevron-left glyphicon-chevron-left" aria-hidden="true"></i>
    <span class="sr-only">Previous</span>
  </a>
  <a class="right carousel-control" href="#carousel-portrait-context" role="button" data-slide="next">
    <i class="fa fa-chevron-right glyphicon-chevron-right" aria-hidden="true"></i>
    <span class="sr-only">Next</span>
  </a>
</div>
</template>
  
<template name="portrait_item_context_section">
  {{#if showContext}}
    <div class="item" style="height: {{carouselHeight}}px">
    <div class="embedly-card" data-context-id="{{_id}}">
      <div class="embedly-card-hug" style="width: 600px; padding: 0px; position: relative; max-width: 100%; margin: 5px auto;">
        <div class="card article">
          <div class="hdr">
            <div class="pull-right provider provider-gt-35">
              <a class="js-link toggle-card-expansion">
                <i class="fa fa-arrows-v" style="padding: 0 8px;"></i>
              </a>
            </div>
            <div class="provider provider-gt-35">
              {{#if providerIconUrl}}
                <img class="provider-favicon" height="16" src="{{providerIconUrl}}" width="16">
              {{/if}}
              <a class="provider-name" href="{{providerUrl}}" target="_blank">{{providerName}}</a>
              {{#if suggestedByUsername}}
                <span class="author">Suggested by {{suggestedByUsername}}</span>
              {{/if}}
              <!-- <span class="author">&nbsp;<a href="https://www.youtube.com/user/calacademy" tabindex="-1" target="_blank">California Academy of Sciences</a></span> -->
            </div>
          </div>
          <div class="bd" style="border-left-color: rgb(224, 42, 25);">
            <div class="pair-bd">
              {{> Template.dynamic template=portraitListModeItemTemplate}}
            </div>
          </div>
        </div>
      </div>
    </div>
    {{#if showAnnotationSection}}
      {{> annotation_section}}
    {{/if}}
  </div>
  {{/if}}
</template>



<!-- old code below -->
<template name="stream_li">
  {{#with stream}}
    <li data-stream-reference-id="{{reference.id}}" data-stream-id="{{_id}}" class="stream {{#if active}}active{{/if}} {{#if previewMode}}preview-mode{{/if}}" style="background-image:url({{thumbnailUrl}}) ">
      <button title="{{title}} by {{username}}" class="set-main-stream {{#if active}}active{{else}}inactive{{/if}} {{#if previewMode}}preview-mode{{/if}}">
        {{#if live}}
          <div class="mini-live-indicator">
            LIVE
          </div>
        {{/if}}

        <!--<img src="{{thumbnailUrl}}">-->
        {{#unless active}}
          <div class="inactive-overlay"></div>
        {{/unless}}
      </button>
      {{#if curateMode}}
        <button class="delete-stream">{{> close_circle}}</button>
      {{/if}}
      {{#if showPreviewButton}}
        {{#if previewMode}}
          <iframe class="stream-preview-overlay-iframe" width="100%" height="100%" frameborder="0" style="border:0"
                  src="{{iframePreviewUrl}}"></iframe>
          <div class="lower-stream-button-overlay">
            <button class="set-main-stream">SET AS MAIN</button>
          </div>
        {{else}}
          <div class="lower-stream-button-overlay">
            {{#if disablePreviewButton}}
              <button class="preview-stream" disabled="disabled">NO PREVIEW</button>
            {{else}}
              <button class="preview-stream">PREVIEW</button>
            {{/if}}
          </div>
        {{/if}}
      {{/if}}
    </li>
  {{/with}}
</template>

<template name="content_icons">
  <div class="row">
    <div class="col-xs-12">
      <div class="search-section-title">Select Card Type</div>
    </div>
  </div>
  <div class="row">
    <!--
    {{#if isCurator}}
    <div class="col-xs-6 col-sm-4 col-md-3 text-center tile-container">
      <a class="js-link thumbnail tile-selector stream-button"  title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} livestreams">
        {{> stream_icon }}
      </a>
      <small>Stream</small>
    </div>
    {{/if}}
    -->
    <div class="col-xs-6 col-sm-4 col-md-3 text-center tile-container">
      <a class="js-link thumbnail tile-selector news-button" title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} news stories" disabled='{{disableAllButStream}}'>
        {{> news_icon }}
      </a>
      <small>News</small>
    </div>
    <div class="col-xs-6 col-sm-4 col-md-3 text-center tile-container">
      <a class="js-link thumbnail tile-selector text-button" title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} text" disabled='{{disableAllButStream}}'>
        {{> text_icon }}
      </a>
      <small>Comment</small>
    </div>
    <div class="col-xs-6 col-sm-4 col-md-3 text-center tile-container">
      <a class="js-link thumbnail tile-selector poll-button" title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} poll" disabled='{{disableAllButStream}}'>
        {{> poll_icon }}
      </a>
      <small>Poll</small>
    </div>
    <div class="col-xs-6 col-sm-4 col-md-3 text-center tile-container">
      <a class="js-link thumbnail tile-selector map-button" title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} maps" disabled='{{disableAllButStream}}'>
        {{> map_icon }}
      </a>
      <small>Map</small>
    </div>
    <div class="col-xs-6 col-sm-4 col-md-3 text-center tile-container">
      <a class="js-link thumbnail tile-selector image-button" title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} images" disabled='{{disableAllButStream}}'>
        {{> image_icon }}
      </a>
      <small>Image</small>
    </div>
    <div class="col-xs-6 col-sm-4 col-md-3 text-center tile-container">
      <a class="js-link thumbnail tile-selector video-button" title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} videos" disabled='{{disableAllButStream}}'>
        {{> video_icon }}
      </a>
      <small>Video</small>
    </div>
    <div class="col-xs-6 col-sm-4 col-md-3 text-center tile-container">
      <a class="js-link thumbnail tile-selector twitter-button" title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} tweets" disabled='{{disableAllButStream}}'>
        {{> twitter_icon }}
      </a>
      <small>Tweet</small>
    </div>
    <div class="col-xs-6 col-sm-4 col-md-3 text-center tile-container">
      <a class="js-link thumbnail tile-selector audio-button" title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} audio" disabled='{{disableAllButStream}}'>
        {{> audio_icon }}
      </a>
      <small>Sound</small>
    </div>
    <div class="col-xs-6 col-sm-4 col-md-3 text-center tile-container">
      <a class="js-link thumbnail tile-selector link-button" title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} links" disabled='{{disableAllButStream}}'>
        {{> link_icon }}
      </a>
      <small>Link</small>
    </div>
    <!--
    <ol>
      {{#if isCurator}}
        <li>
          <button title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} livestreams" class='stream-button {{#if stream}}active{{/if}}'>
            {{> stream_icon }}
          </button>
        </li>
      {{/if}}
      <li>
        <button title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} news stories" class='news-button {{#if news}}active{{/if}}' disabled='{{disableAllButStream}}'>
          {{> news_icon }}
        </button>
      </li>
      <li>
        <button title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} text" class='text-button {{#if text}}active{{/if}}' disabled='{{disableAllButStream}}'>
          {{> text_icon }}
        </button>
      </li>
      <li>
        <button title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} poll" class='poll-button {{#if poll}}active{{/if}}' disabled='{{disableAllButStream}}'>
          {{> poll_icon }}
        </button>
      </li>
      <li>
        <button title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} maps" class='map-button {{#if map}}active{{/if}}' disabled='{{disableAllButStream}}'>
          {{> map_icon }}
        </button>
      </li>
      <li>
        <button title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} images" class='image-button {{#if image}}active{{/if}}' disabled='{{disableAllButStream}}'>
          {{> image_icon }}
        </button>
      </li>
      -->
      <!--<li>-->
      <!--<button title="{{#unless isCurator}}Suggest{{else}}"{{/unless}} class='wikipedia-button {{#if wikipedia}}active{{/if}}' disabled='{{disableAllButStream}}'>-->
      <!--{{> wikipedia_icon }}-->
      <!--</button>-->
      <!--</li>-->
     <!--
      <li>
        <button title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} videos" class='video-button {{#if video}}active{{/if}}' disabled='{{disableAllButStream}}'>
          {{> video_icon }}
        </button>
      </li>
      <li>
        <button title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} tweets" class='twitter-button {{#if twitter}}active{{/if}}' disabled='{{disableAllButStream}}'>
          {{> twitter_icon }}
        </button>
      </li>
      <li>
        <button title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} audio" class='audio-button {{#if audio}}active{{/if}}' disabled='{{disableAllButStream}}'>
          {{> audio_icon }}
        </button>
      </li>
      <li>
        <button title="{{#unless isCurator}}Suggest{{else}}Add{{/unless}} links" class='link-button {{#if link}}active{{/if}}' disabled='{{disableAllButStream}}'>
          {{> link_icon }}
        </button>
      </li>
    </ol>
    -->
  </div>
</template>

<template name="relevant_content_icon">
  {{> Template.dynamic template=iconTemplate}}
</template>

<template name="creation_tutorial">
  <!-- development mode remove steps
  <div class="tutorial">
    <div class="tutorial-step find-stream {{#if onFindStreamStep}}active{{/if}}">
      <div class="text">
        <span class="number">Step 1:</span><span
          class="instruction">Find streams that you want to curate on the right.</span>
      </div>
      <button>Skip this step ></button>
    </div>
    <div class="tutorial-step add-cards {{#if onAddCardsStep}}active{{/if}}">
      <div class="text">
        <span class="number">Step 2:</span><span class="instruction">Add cards on the right to give viewers more information.</span>
      </div>
      <button>Skip this step ></button>
    </div>
    <div class="tutorial-step go-on-air {{#if onGoOnAirStep}}active{{/if}}">
      <div class="text">
        <span class="number">Step 3:</span><span class="instruction">Put your Deep Stream on air!</span>
      </div>
      <button class="publish">Publish!</button>
      <span class="divider">OR</span>
      <button class="preview">Preview</button>
    </div>
  </div>
 -->
</template>

<template name="title_description_inlay">
  <div class="row">
    <div class="col-xs-12">
      <form class="publish-with-title-description" action="action" autocomplete="off">
       <div class="form-group">
          <label for="title">Enter a title for your Deep Stream:</label>
          <input type="text" id="set-stream-title" name="title" value="{{title}}" class="form-control set-title" placeholder="Put your title here." autofocus="autofocus">
          <div class="character-count"><p class="text-muted">{{titleLength}} / {{titleMax}}</p></div>
        </div>
        
        <div class="form-group">
          <label for="description">Enter a description:</label>
          <textarea id="set-stream-description" name="description" value="{{description}}" class="form-control set-description" placeholder="Put your description here." autofocus="autofocus" rows="3"></textarea>
          <div class="character-count"><p class="text-muted">{{descriptionLength}} / {{descriptionMax}}</p></div>
        </div>
        <!-- <button type="submit" class="btn btn-outline-success">publish</button>-->
      </form>
    </div>
  </div>
</template>


<template name="context_card_column">
  <div class="card-column">
    <div class="previews-container">
      {{#unless replayEnabled}}
        {{#each orderedInternalContext}}
          <div class="context-mini-preview {{#if isActiveContext}}{{/if}}" data-context-id="{{_id}}">{{> relevant_content_icon}}</div>
        {{/each}}
      {{/unless}}
    </div>
  </div>
</template>
 
<template name="context_browser">
  <div class="{{#if suggestions}}suggestion-browser{{else}}context-browser{{/if}} {{#unless show}}hide{{/unless}}">
      {{#if curateMode}}
        {{#unless browseSuggestionsMode}}
        <div class="row add-new-card-row">
          <div class="col-xs-12">
            <a class="js-link thumbnail tile-selector" title="View Content Manager">
              <i class="fa fa-plus-circle"></i> View Content Manager
            </a>
          </div>
        </div>
        {{/unless}}
      {{/if}}
      {{#unless browseSuggestionsMode}}
        {{#if newContextAvailable}}
        <!--
        <div class="row update-new-context-row hot-notification">
          <div class="col-xs-12">
            New card! Click to show!
          </div>
        </div>
        -->
        {{/if}}
      {{/unless}}
      {{#if soloSidebarContextMode}}
        <div class="row">
          <div class="col-xs-12">
            {{#with currentContext}}
              {{> solo_context_section}}
            {{/with}}
          </div>
        </div>
      {{else}}
        <!--<div class="top-bar"></div>-->
      {{/if}}
      <div class="context-area list-mode {{#if soloSidebarContextMode}}hide{{/if}}">
        {{#unless curateMode}}
        <div class="row">
          <div class="col-xs-12 text-center suggest-content js-link suggest-content-card narrative-section context-section list-item-context-section news-card curator-card" style="margin-bottom:20px;">
            <b>Suggest a Card</b>
          </div>
        </div>
        {{/unless}}
        
        {{#each contextBlocks}}
          {{> list_item_context_section}}
        {{/each}}
      </div>
  </div>
</template>

<template name="overlay_context_browser">
  <div class="overlay-context-browser" style="width: {{windowWidth}}px; height: {{windowHeight}}px;">
    <div class="context-area">
      {{#with currentContext}}
        {{> solo_context_section}}
      {{/with}}
    </div>
  </div>
</template>

<template name="solo_context_section">
  <div class="row thumbnail {{#if type}}{{type}}-card{{/if}}" data-context-id="{{_id}}">
    <div class="col-xs-12">
      <div class="row">
        <div class="col-xs-9">
        {{#if showProvider}}
          <div class="provider">{{#if providerIconUrl}}<img class="provider-image" src="{{providerIconUrl}}"/>{{/if}}{{providerName}}</div>
        {{/if}}
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12">
          {{> Template.dynamic template=soloModeTemplate}}
        </div>
      </div>
    </div>
  </div>
  <div class="narrative-section context-section solo-context-section" >

  </div>
</template>

<template name="list_item_context_section">
  {{#if showContext}}
  <div class="row thumbnail list-item-context-plus-annotation context-section {{#if type}}{{type}}-card{{/if}} {{#if hasSoloMode}}{{#unless curateMode}}isClickable{{/unless}}{{/if}}" data-context-id="{{_id}}">
    <div class="col-xs-12">
      <div class="row main-card-section" style="padding: 7px 3px;">
        <div class="col-xs-12 clickable">
          <div class="row">
            <div class="col-xs-12">
            <!--
            {{#if suggestedByUsername}}
            <div class="row">
              <div class="col-xs-12">
                <p>@{{suggestedByUsername}} suggested this card</p>
              </div>
            </div>
            {{/if}}
            -->
            <!-- no provider icon in viv mockup
            <div class="row">
              <div class="col-xs-12">
                <div class="provider">{{#if providerIconUrl}}<img class="provider-image" src="{{providerIconUrl}}" height="32"/>{{/if}}{{providerName}}</div>
              </div>
            </div>
            -->
            <div class="row">
              <div class="col-xs-12">
                {{> Template.dynamic template=listModeItemTemplate}}
                <!--
                {{#unless curateMode}}
                  {{#if hoverIconTemplate}}<button class="hover-icon">{{> Template.dynamic template=hoverIconTemplate}}</button>{{/if}}
                {{/unless}}
                -->
              </div>
            </div>
            </div>
            <!--<div class="col-xs-1"></div>-->
          </div>
          {{#if showAnnotationSection}}
          <div class="row">
            <div class="col-xs-12">
              {{> annotation_section}}
            </div>
          </div>
           {{/if}}
          {{#if replayEnabled}}
          {{#if showVideoMarkerSection}}
          <div class="row">
            <div class="col-xs-12">
              {{> video_marker_section}}
            </div>
          </div>
          {{/if}}
          {{/if}}
          <!-- to do  add a delete card button-->
          {{#if curateMode}}
            {{#unless browseSuggestionsMode}}
          <div class="row">
            <button title="Remove card" class="col-xs-10 col-xs-offset-1 btn btn-outline-danger delete-context"><i class="fa fa-close"></i> Remove Card</button>
          </div>
            {{/unless}}
          {{/if}}
        </div>
      </div>
      {{#if browseSuggestionsMode}}
      <div class="row">
        <div class="col-xs-6">
          <button class="approve-suggestion"><i class="fa fa-check"></i> Approve</button>
        </div>
        <div class="col-xs-6">
          <button class="reject-suggestion"><i class="fa fa-close"></i> Reject</button>
        </div>
      </div>
      {{/if}}
    </div>
  </div>
  {{/if}}
</template>

<template name="annotation_section">
  <div class="row">
    <div class="col-xs-12">
       {{{annotation}}}
    </div>
  </div>
</template>

<template name="video_marker_section">
  <div class="video-marker-section">
    {{> clock_icon}}<span>Card appears at: <input name="videoMarker" class="text-content editable video-marker" rows="1" value="{{formatDuration videoMarker}}" dir="auto" /></span>
  </div>
</template>

<template name="timeline_section">
  <div class="row thumbnail timeline-section {{#unless show}}hide{{/unless}}" style="height:{{mainStreamHeight}}px;{{#if portrait}}margin: 0px; padding-top: 0px; background-color: #000;{{else}}margin-bottom: 0px;{{/if}}">
    <div class="col-xs-12">
      {{#unless portrait}}
      {{#if curateMode}}
      <div class="row">
        <div class="col-xs-12">
          <form id="timeline-embed" action="" autocomplete="off">
            <div class="form-group">
              <label for="timeline-embed-code-input">
                <a href="https://twitter.com/settings/widgets/new/search" target="_blank">Create a new Timeline widget</a> and enter the generated embed code or url here
              </label>
              <input type="text" class="form-control" id="timeline-embed-code-input" name="timeline-embed-code" placeholder="Paste your embed code or url here.">
            </div>
            <button type="submit" class="btn btn-outline-success submit-timeline-embed-code">Update Timeline</button>
          </form>
        </div>
      </div>
      {{/if}}
      {{/unless}}
      <div class="row">
        <div class="col-xs-12">
          <div id='twitter-timeline' class="timeline-container" style="max-width:100%; height:{{#if curateMode}}{{mainStreamHeight -137}}{{else}}{{mainStreamHeight -26}}{{/if}}px;"></div>
        </div>
      </div>
    </div>
  </div>
</template>

<template name="portrait_timeline_section">
    <div class="timeline-section {{#unless show}}hide{{/unless}}" style="height:{{carouselHeight}}px; margin: 0px; padding-top: 0px; background-color: #000;">
      <a class="js-link toggle-card-expansion" style="position: fixed; right: 23px; font-size:13px">
        <i class="fa fa-arrows-v fa-inverse" style="padding: 18px;"></i>
      </a>
      <div id='twitter-timeline' class="timeline-container" style="max-width:100%;"></div>
    </div>
</template>


<template name="curator_webcam_display">
  <object id="curator-webcam-stream" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"
          class="curator-webcam-stream-flash-object">
    <embed name="curator-webcam-stream" src="//static.bambuser.com/r/player.swf"
           type="application/x-shockwave-flash" flashvars="{{curatorWebcamFlashVars}}" allowfullscreen="true"
           allowscriptaccess="always" wmode="opaque"/>
    <param name="movie" value="//static.bambuser.com/r/player.swf"/>
    <param name="flashvars" value="{{curatorWebcamFlashVars}}"/>
    <param name="allowfullscreen" value="true"/>
    <param name="allowscriptaccess" value="always"/>
    <param name="wmode" value="opaque"/>
  </object>
</template>
